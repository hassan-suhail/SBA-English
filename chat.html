<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div id="chat-box">
        <!-- Display messages here -->
    </div>
    <input type="text" id="message-input" placeholder="Enter your message">
    <button onclick="sendMessage()">Send</button>

    <script>
        const CLIENT_ID = "452875508182-oh59nv1r45bbapn77o7iqmp688levf97.apps.googleusercontent.com"; // Replace with your OAuth Client ID
        const API_KEY = "AIzaSyBPqIF_BJstzy0W2gVJr52wG6f3HQS2-kQ"; // Replace with your Google API Key
        const SPREADSHEET_ID = "17saqjGpfCLxFvTGrlIwPbJ-TeupNthLoGkx34hHu204"; // Replace with your Google Sheets ID
        const RANGE = "Sheet1!A:B"; // Adjust according to your sheet structure

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                scope: "https://www.googleapis.com/auth/spreadsheets"
            }).then(() => {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }

        function handleClientLoad() {
            gapi.load("client:auth2", initClient);
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                console.log("Signed in successfully");
            } else {
                gapi.auth2.getAuthInstance().signIn();
            }
        }

        function sendMessage() {
            const message = document.getElementById("message-input").value;
            if (!message) {
                alert("Please enter a message.");
                return;
            }
            const timestamp = new Date().toLocaleString();
            const values = [[message, timestamp]];

            const body = {
                values: values
            };

            gapi.client.sheets.spreadsheets.values.append({
                spreadsheetId: SPREADSHEET_ID,
                range: RANGE,
                valueInputOption: "RAW",
                resource: body
            }).then((response) => {
                if (response.status === 200) {
                    displayMessage(message, timestamp);
                    document.getElementById("message-input").value = "";
                } else {
                    alert("Error sending message");
                }
            }).catch(error => console.error("Error sending message:", error));
        }

        function displayMessage(message, timestamp) {
            const chatBox = document.getElementById("chat-box");
            const messageElem = document.createElement("p");
            messageElem.textContent = `${timestamp}: ${message}`;
            chatBox.appendChild(messageElem);
        }

        // Load the API client and auth library
        handleClientLoad();
    </script>
</body>
</html>
